# Task Quality Assessment

Plans generated by users or LLMs often lack sufficient detail for implementation. Assess each task before developer
assignment.

## Quality Criteria

A task is **implementable** when ALL criteria are present:

| Criterion               | Description                          | Sufficient                         | Insufficient            |
|-------------------------|--------------------------------------|------------------------------------|-------------------------|
| **Clear Scope**         | Specific deliverable with boundaries | "Add rate limiting to /api/users"  | "Improve API security"  |
| **Acceptance Criteria** | Verifiable completion conditions     | "Returns 429 after 100 req/min"    | "Should be fast"        |
| **Target Location**     | Files/modules identifiable           | "Modify src/api/users.rs"          | "Update the backend"    |
| **Technical Approach**  | Strategy determinable from context   | "Use token bucket algorithm"       | "Add some limiting"     |
| **Dependencies Clear**  | Required interfaces known            | "Uses RateLimiter from src/common" | "Integrate with system" |

## Classification

| Classification        | Definition                                   | Action                 |
|-----------------------|----------------------------------------------|------------------------|
| `IMPLEMENTABLE`       | All criteria met                             | Ready for developer    |
| `NEEDS_EXPANSION`     | Missing 1-2 criteria inferable from codebase | Spawn business analyst |
| `NEEDS_CLARIFICATION` | Missing criteria requiring user input        | Divine intervention    |

## Business Analyst Prompt Template

```
Task Expansion Request

Original Task: {{task_id}}
Original Description: {{task_description}}
Original Acceptance Criteria: {{acceptance_criteria | default: "None specified"}}

CONTEXT FROM PLAN:
{{plan_context}}

---

You are a Business Analyst expanding an underspecified task into an implementable specification.

EXPANSION REQUIREMENTS:
Ground your expansion in:
1. Information explicitly stated in the plan
2. Patterns and conventions discovered in the codebase
3. Logical inference from the above (clearly mark as inferred)

CODEBASE ANALYSIS:
Before expanding, use Glob and Grep to discover:
- Similar implementations in the codebase
- Target files/modules to modify
- Available utilities and interfaces
- Testing patterns to follow

OUTPUT FORMAT:

EXPANDED_TASK_SPECIFICATION
Task: {{task_id}}
Confidence: [HIGH | MEDIUM | LOW]

Summary: [1-2 sentence description]

Scope:
- [Specific deliverable 1]
- [Specific deliverable 2]

Target Files:
- [file path]: [what changes]

Technical Approach:
[Step-by-step implementation strategy based on codebase patterns]

Acceptance Criteria:
- [ ] [Verifiable criterion with command/test]

Dependencies:
- [Module/interface this depends on]

Assumptions (require validation):
- [Any assumptions made]

---

CONFIDENCE LEVELS:
- HIGH: All from plan or codebase, no assumptions
- MEDIUM: Reasonable logical inference required
- LOW: Significant assumptions or multiple valid interpretations

If LOW confidence, explain what clarification would raise it.
```

## Handling Results

### HIGH/MEDIUM Confidence

1. Store expanded spec in `expanded_tasks`
2. Mark task as `IMPLEMENTABLE`
3. Add to `available_tasks`
4. Log `task_expanded` event

### LOW Confidence

1. Extract clarification questions
2. Add to `pending_divine_questions`
3. Keep task in `pending_expansions` with status "awaiting-clarification"
4. Log `expansion_needs_clarification` event
5. Invoke divine intervention

## Integration Points

Task quality assessment runs:

1. **Initial plan load**: Before any development
2. **Full plan reload**: Re-assess tasks not yet started
3. **New task discovery**: If plan has dynamic tasks

Coordinator must NOT dispatch developers for `NEEDS_EXPANSION` or `NEEDS_CLARIFICATION` tasks.
